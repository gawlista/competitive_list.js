(function(){this.CompetitiveList=function(){function t(t){this.competitiveListOptions=t,this.competitiveListOptions||(this.competitiveListOptions={}),$(document.body).on("click",this.competitiveListOptions.id+" .competitive_list_start_link",function(t){return function(e){return e.preventDefault(),t.start()}}(this)),$(document.body).on("click",this.competitiveListOptions.id+" .save_match_results_link",function(t){return function(e){return e.preventDefault(),t.sortByMostWins(),$(t.competitiveListOptions.id+" .save_match_results_link").hide()}}(this)),$(document.body).on("click",this.competitiveListOptions.id+"_buttons .cancel_tournament_button",function(t){return function(e){return e.preventDefault(),t.cancelTournament()}}(this)),$(document.body).on("click",this.competitiveListOptions.id+"_buttons .select_winner_button",function(t){return function(e){return e.preventDefault(),t.appointWinnerOfMatchByInput()}}(this))}return t.prototype.competitiveListOptions=[],t.prototype.competitors=[],t.prototype.competitorsOfCompetitor={},t.prototype.defeatedCompetitorsByCompetitor={},t.prototype.outmatchedCompetitorsByCompetitor={},t.prototype.matchesLeft=0,t.prototype.currentMatch=null,t.prototype.currentMatchIndex=0,t.prototype.currentAutoWinnerMatches=[],t.prototype.movingCompetitorToPosition=!1,t.meaningOfLife=function(){return 42},t.prototype.start=function(){var t,e;return t=!1,window.matches||(window.matches=[]),window.matches.length>0&&(t=!0),this.setCompetitors(),this.competitorsOfCompetitor={},this.defeatedCompetitorsByCompetitor={},this.outmatchedCompetitorsByCompetitor={},t&&(confirm("Remove previous results and start over?")?window.matches=[]:this.removeMatchesOfNonExistingCompetitors()),this.generateMatches(),e=jQuery.map(window.matches,function(t){return void 0===t.winner?t:void 0}),this.matchesLeft=e.length,this.nextMatch(!0)?$("#bootstrap_modal").modal("show"):void 0},t.prototype.setCompetitors=function(){return this.competitors=jQuery.map($(".competitive_list li"),function(t){return $(t).data("id")})},t.prototype.removeMatchesOfNonExistingCompetitors=function(){return $.each(window.matches,function(t){return function(e,o){var n,i,r,s,a,c;return c=jQuery.map(o.competitors,function(e){return-1===$.inArray(e,t.competitors)?e:void 0}),c.length>0?window.matches=t.removeItemFromArray(window.matches,o):((n=t.competitorsOfCompetitor)[s=o.competitors[0]]||(n[s]=[]),t.competitorsOfCompetitor[o.competitors[0]].push(o.competitors[1]),(i=t.competitorsOfCompetitor)[a=o.competitors[1]]||(i[a]=[]),t.competitorsOfCompetitor[o.competitors[1]].push(o.competitors[0]),void 0!==o.winner?(r=t.otherCompetitorOfMatch(o,o.winner),t.updateDefeatedAndOutmatchedCompetitorsByCompetitor(o.winner,r)):void 0)}}(this))},t.prototype.removeItemFromArray=function(t,e){var o;return o=[],jQuery.each(t,function(t,n){return JSON.stringify(n)!==JSON.stringify(e)?o.push(n):void 0}),o},t.prototype.generateMatches=function(){return $.each(this.competitors,function(t){return function(e,o){var n;return(n=t.competitorsOfCompetitor)[o]||(n[o]=[]),$.each(t.competitors,function(e,n){var i;return(i=t.competitorsOfCompetitor)[n]||(i[n]=[]),o!==n&&-1===$.inArray(n,t.competitorsOfCompetitor[o])?(window.matches.push({competitors:[o,n]}),t.competitorsOfCompetitor[o].push(n),t.competitorsOfCompetitor[n].push(o)):void 0})}}(this))},t.prototype.nextMatch=function(t){var e,o,n,i,r,s,a,c,p;return e="",this.currentAutoWinnerMatches.length>0&&(this.currentMatch=window.matches[this.currentMatchIndex],p="",$.each(this.currentAutoWinnerMatches,function(t){return function(e,o){var n,i;return n="",n=e%2===0?"even":"odd",i="",o.manual_winner_changed===!0&&(i='<a class="bootstrap_tooltip" href="#" data-toggle="tooltip" title="The winner you once have set has been changed automatically!">\n  <i class=\'icon-warning-sign\'/>\n</a>'),p+='<tr class="'+n+'">\n  <td>\n    '+i+'\n  </td>\n  <td style="width:200px">'+t.nameOfCompetitor(o.winner,!1)+'</td>\n  <td><input type="radio" checked="checked" disabled="disabled"/></td>\n  <td>&nbsp;&nbsp;VS.&nbsp;&nbsp;&nbsp;</td>\n  <td><input type="radio" disabled="disabled"/></td>\n  <td>&nbsp;&nbsp;&nbsp;</td>\n  <td style="width:200px">'+t.nameOfCompetitor(t.otherCompetitorOfMatch(o,o.winner),!1)+'</td>\n  <td style="text-align:center">\n    <a class="bootstrap_tooltip" href="#" data-toggle="tooltip" data-html="true" title="'+o.auto_winner_reason+'">\n      <i class="icon-question-sign"/>\n    </a>\n  </td>\n  <td style="width:200px">'+t.nameOfCompetitor(o.foot_note_competitor,!1)+"</td>\n</tr>        "}}(this)),e="<h4>Auto Winners due to Result of last Match</h4>\n<table>\n  <tr>\n    <td><strong>Last Match was:&nbsp;&nbsp;</strong></td>\n    <td>"+this.nameOfCompetitor(this.currentMatch.winner,!1)+'</td>\n    <td>&nbsp;&nbsp;<input type="radio" checked="checked" disabled="disabled"/></td>\n    <td>&nbsp;&nbsp;VS.&nbsp;&nbsp;&nbsp;</td>\n    <td><input type="radio" disabled="disabled"/></td>\n    <td>&nbsp;&nbsp;&nbsp;</td>\n    <td>'+this.nameOfCompetitor(this.otherCompetitorOfMatch(this.currentMatch,this.currentMatch.winner),!1)+'</td>\n  </tr>\n</table>\n<table class="table table-striped">\n  <thead>\n    <tr class="odd">\n      <th></th>\n      <th>Winner</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th>Loser</th>\n      <th>Reason</th>\n      <th>[1]</th>\n    </tr>\n  </thead>\n  <tbody>\n    '+p+"\n  </tbody>\n</table>   "),this.currentMatch=null,$.each(window.matches,function(t){return function(e,o){return void 0===o.winner?(t.currentMatch=o,t.currentMatchIndex=e,!1):void 0}}(this)),t===!0&&null===this.currentMatch?(alert("No matches to rate left."),!1):($(this.competitiveListOptions.id+" .save_match_results_link").show(),r="",a="",s="",null===this.currentMatch?(a="No matches to rate left.",s='<p id="'+this.competitiveListOptions.id.replace("#","")+'_buttons">\n  <button type="button" class="cancel_tournament_button" class="btn">Save match results and close window</button>\n</p>      '):(a="Appoint Winner ("+this.matchesLeft+" matches left)",c=[],o=[],i=0,$.each(this.currentMatch.competitors,function(t){return function(e,n){var r;return r=' checked="checked"',1===i&&(r=""),c.push('<input type="radio" '+r+' name="winner" value="'+n+'" style="position:relative; top:-5px "/>'),o.push(t.nameOfCompetitor(n,!0)),i+=1}}(this)),r+='<div class="controls" style="margin-left:50px">\n  <table>\n    <tr>      \n      <td style="width:325px; text-align:right;">\n        '+o[0]+"\n      </td>\n      <td>&nbsp;&nbsp;&nbsp;</td>\n      <td>"+c[0]+"</td>\n      <td>&nbsp;&nbsp;VS.&nbsp;&nbsp;&nbsp;</td>\n      <td>"+c[1]+'</td>\n      <td>\n        &nbsp;&nbsp;&nbsp;\n      </td>\n      <td style="width:325px">\n        '+o[1]+"\n      </td>\n    </tr>\n  </table>\n</div>     ",s='<p id="'+this.competitiveListOptions.id.replace("#","")+'_buttons">\n  <button type="button" class="cancel_tournament_button" class="btn">Save match results and close window</button> &nbsp;&nbsp;&nbsp;&nbsp;\n  <button type="button" class="select_winner_button" class="btn btn-primary">Submit</button>\n</p>'),r+=e,n='<form class="form-inline" style="margin:0px;">\n  <div class="modal-header">\n    <button type="button" id="close_bootstrap_modal_button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n    <h3>'+a+'</h3>\n  </div>\n  <div class="modal-body" style="overflow-y:auto;">\n    '+r+'\n  </div>\n  <div class="modal-footer" style="text-align:left;">\n    '+s+"\n  </div>\n</form>",$("#bootstrap_modal").html(n),$(".bootstrap_tooltip").tooltip(),this.currentAutoWinnerMatches=[],!0)},t.prototype.otherCompetitorOfMatch=function(t,e){var o;return o=jQuery.map(t.competitors,function(t){return t!==e?t:void 0}),o[0]},t.prototype.nameOfCompetitor=function(t,e){var o;return o=$("#competitor_"+t),e===!1||void 0===this.competitiveListOptions.competitor_name_proc||void 0===$(o).find(".competitor_name").data("proc-argument")?$(o).find(".competitor_name").html():this.competitiveListOptions.competitor_name_proc($(o).find(".competitor_name").data("proc-argument"))},t.prototype.cancelTournament=function(){return this.sortByMostWins(),$(this.competitiveListOptions.id+" .save_match_results_link").hide(),$("#bootstrap_modal").modal("hide")},t.prototype.appointWinnerOfMatchByInput=function(){var t,e;return e=parseInt($("input[name='winner']:checked").val()),t=this.otherCompetitorOfMatch(this.currentMatch,e),this.appointWinnerOfMatch(this.currentMatchIndex,e,t,!0),this.nextMatch(!1)},t.prototype.appointWinnerOfMatch=function(t,e,o,n){return this.movingCompetitorToPosition===!0&&(delete window.matches[t].manual_winner_changed,delete window.matches[t].auto_winner,delete window.matches[t].foot_note_competitor,delete window.matches[t].auto_winner_type,delete window.matches[t].auto_winner_recursion,delete window.matches[t].auto_winner_reason),window.matches[t].winner=e,n&&(this.matchesLeft=this.matchesLeft-1),this.updateDefeatedAndOutmatchedCompetitorsByCompetitor(e,o),this.letWinnerWinMatchesAgainstCompetitorsWhichLoseAgainstLoser(e,o),this.letOutMatchedCompetitorsOfWinnerWinAgainstLoser(e,o)},t.prototype.updateDefeatedAndOutmatchedCompetitorsByCompetitor=function(t,e){var o,n;return(o=this.defeatedCompetitorsByCompetitor)[t]||(o[t]=[]),this.defeatedCompetitorsByCompetitor[t].push(e),(n=this.outmatchedCompetitorsByCompetitor)[e]||(n[e]=[]),this.outmatchedCompetitorsByCompetitor[e].push(t)},t.prototype.letWinnerWinMatchesAgainstCompetitorsWhichLoseAgainstLoser=function(t,e){var o;return(o=this.defeatedCompetitorsByCompetitor)[e]||(o[e]=[]),$.each(window.matches,function(o){return function(n,i){var r,s,a;return i.winner===t||-1===$.inArray(t,i.competitors)?!0:(s=jQuery.map(i.competitors,function(t){return $.inArray(t,o.defeatedCompetitorsByCompetitor[e])>-1?t:void 0}),0===s.length?!0:(a=o.otherCompetitorOfMatch(i,t),r=!1,void 0!==i.winner&&(o.removeCompetitorsComparisonResult(t,a),o.movingCompetitorToPosition!==!0&&i.auto_winner!==!0&&(r=!0)),o.appointWinnerOfMatch(n,t,a,void 0===i.winner),o.movingCompetitorToPosition===!0?!0:(window.matches[n].manual_winner_changed=r,window.matches[n].auto_winner=!0,window.matches[n].foot_note_competitor=e,window.matches[n].auto_winner_type=0,t===o.currentMatch.winner&&e===o.otherCompetitorOfMatch(o.currentMatch,o.currentMatch.winner)?(window.matches[n].auto_winner_recursion=!1,window.matches[n].auto_winner_reason="loser has been defeated because he loses against the loser <sup>[1]</sup> of last match"):(window.matches[n].auto_winner_recursion=!0,window.matches[n].auto_winner_reason="loser has been defeated because he loses against the loser <sup>[1]</sup> of last auto winner match"),o.currentAutoWinnerMatches.push(window.matches[n]))))}}(this))},t.prototype.removeCompetitorsComparisonResult=function(t,e){var o;return(o=this.outmatchedCompetitorsByCompetitor)[t]||(o[t]=[]),this.outmatchedCompetitorsByCompetitor[t]=this.removeItemFromArray(this.outmatchedCompetitorsByCompetitor[t],e),this.defeatedCompetitorsByCompetitor[e]=this.removeItemFromArray(this.defeatedCompetitorsByCompetitor[e],t)},t.prototype.letOutMatchedCompetitorsOfWinnerWinAgainstLoser=function(t,e){var o;return(o=this.outmatchedCompetitorsByCompetitor)[t]||(o[t]=[]),$.each(this.outmatchedCompetitorsByCompetitor[t],function(o){return function(n,i){return $.each(window.matches,function(n,r){var s;return $.inArray(i,r.competitors)>-1&&$.inArray(e,r.competitors)>-1&&r.winner!==i?(s=!1,void 0!==r.winner&&(o.removeCompetitorsComparisonResult(i,e),o.movingCompetitorToPosition!==!0&&r.auto_winner!==!0&&(s=!0)),o.appointWinnerOfMatch(n,i,e,void 0===r.winner),o.movingCompetitorToPosition===!0?!0:(window.matches[n].manual_winner_changed=s,window.matches[n].auto_winner=!0,window.matches[n].auto_winner_type=1,window.matches[n].foot_note_competitor=t,t===o.currentMatch.winner&&e===o.otherCompetitorOfMatch(o.currentMatch,o.currentMatch.winner)?(window.matches[n].auto_winner_recursion=!1,window.matches[n].auto_winner_reason="loser of last match has been defeated by outmatched competitor of<br/>winner <sup>[1]</sup>"):(window.matches[n].auto_winner_recursion=!0,window.matches[n].auto_winner_reason="loser of last auto winner match has been defeated by outmatched competitor of winner <sup>[1]</sup>"),o.currentAutoWinnerMatches.push(r),!1)):void 0})}}(this))},t.prototype.moveCompetitorToPosition=function(t,e,o){var n,i,r,s;return null==o&&(o=null),this.movingCompetitorToPosition=!0,this.setCompetitors(),this.competitorsOfCompetitor={},this.removeMatchesOfNonExistingCompetitors(),this.generateMatches(),s=this.getPositions(),i=null,n=null,r=s[e]===t?e+1:e,e>Object.keys(s).length?(alert("This position is not available!"),null!==o&&o(),void(this.movingCompetitorToPosition=!1)):(1===e||e-1>Object.keys(s).length||(i=s[e-1]),r>Object.keys(s).length||(n=s[r]),$.each(window.matches,function(e){return function(o,r){var s,a,c;return-1===$.inArray(t,r.competitors)?!0:(c=null,s=null,a=e.otherCompetitorOfMatch(r,t),a===i&&r.winner!==a?(c=a,s=t,i=null):a===n&&r.winner!==t&&(c=t,s=a,n=null),null===c?!0:(void 0!==r.winner&&e.removeCompetitorsComparisonResult(c,s),e.currentMatch=r,e.currentMatchIndex=o,e.appointWinnerOfMatch(o,c,s,!1),null===i&&null===n?!1:void 0))}}(this)),this.sortByMostWins(o),this.movingCompetitorToPosition=!1)},t.prototype.sortByMostWins=function(t){var e,o,n;return null==t&&(t=null),n={},$.each(this.competitors,function(){return function(t,e){return n[e]=0}}(this)),$.each(window.matches,function(t,e){return delete window.matches[t].auto_winner_reason,n[e.winner]+=1}),$.each(Object.keys(n),function(t,e){return $("#competitor_"+e).data("wins",n[e])}),e=$(".competitive_list"),e.find("li").sort(function(t,e){return+parseInt($(e).data("wins"))-+parseInt($(t).data("wins"))}).appendTo(e),void 0!==$(".competitive_list").data("update-all-positions-path")?(o={_method:"put",positions:this.getPositions(),matches:JSON.stringify(window.matches)},$.post($(".competitive_list").data("update-all-positions-path"),o).always(function(){return function(){return null!==t?t():void 0}}(this))):void 0},t.prototype.getPositions=function(){var t,e;return e={},t=1,$.each($(".competitive_list li"),function(o,n){return e[t]=$(n).data("id"),$(n).data("position",t),$(n).find(".competitor_position").html(t),t+=1}),e},t}()}).call(this);